/* assets/assets/printable.css (最終確定版) */

@page {
    size: A4 portrait;
    margin: 15mm;
}

@media print {
    /* =================================== */
    /* 基本設定 & リセット */
    /* =================================== */
    html, body {
        margin: 0 !important;
        padding: 0 !important;
        background: #fff !important;
        font-size: 9pt;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    
    * {
        box-sizing: border-box !important;
    }

    /* =================================== */
    /* 非表示要素の指定 */
    /* =================================== */
    #report-header,
    #report-header + hr {
        display: none !important;
    }

    /* =================================== */
    /* レイアウト調整 */
    /* =================================== */
    
    #report-dashboard-content > .row > .col-md-8,
    #report-dashboard-content > .row > .col-md-4 {
        flex: 0 0 100% !important;
        max-width: 100% !important;
        padding: 0 !important;
    }
    
    /* 縦棒グラフ群(右列)のレイアウト */
    #subject-charts-row {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: wrap !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        page-break-inside: avoid !important;
    }
    
    #subject-charts-row > * {
        flex: 0 0 25% !important;
        max-width: 25% !important;
        padding: 3px !important;
        page-break-inside: avoid !important;
    }

    /* ★★★ ここからが今回の修正の核心部分です ★★★ */
    /*
     * 横棒グラフ(左列)の高さ自動調整
     * Plotlyが生成するグラフのコンテナ(js-plotly-plot)、
     * その内側のdiv(plotly)、SVGコンテナ、そしてSVG本体まで、
     * すべての高さ指定を強制的に上書きして自動調整させます。
    */
    #report-dashboard-content .col-md-8 .js-plotly-plot,
    #report-dashboard-content .col-md-8 .js-plotly-plot .plotly,
    #report-dashboard-content .col-md-8 .js-plotly-plot .svg-container,
    #report-dashboard-content .col-md-8 .js-plotly-plot svg.main-svg {
        height: 100% !important;
    }
    #report-dashboard-content .col-md-8 > div > div:first-child {
        height: auto !important;
        min-height: 250px; /* グラフが少なくても最低限の高さを確保 */
    }
    /* ★★★ ここまで追加 ★★★ */


    /* =================================== */
    /* その他共通スタイル */
    /* =================================== */
    .page-break {
        page-break-after: always;
    }
    
    #report-comment-input {
        border: 1px solid #ccc !important;
        background-color: #f8f9fa !important;
        color: #000 !important;
        height: 400px;
    }

    .card, .js-plotly-plot { 
        box-shadow: none !important; 
        border: 1px solid #ddd !important; 
    }

    .row, .col, .card, h2, h4, .table { 
        page-break-inside: avoid; 
    }
    h2, h4 { 
        page-break-after: avoid; 
    }
}