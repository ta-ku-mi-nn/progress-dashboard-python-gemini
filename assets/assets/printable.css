/* assets/assets/printable.css (改) */

@page {
    size: A4 portrait;
    margin: 15mm;
}

@media print {
    /* =================================== */
    /* 基本設定 & リセット */
    /* =================================== */
    html, body {
        margin: 0 !important;
        padding: 0 !important;
        background: #fff !important;
        font-size: 9pt;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    
    * {
        box-sizing: border-box !important;
    }

    /* =================================== */
    /* 非表示要素の指定 */
    /* =================================== */
    /* 操作ヘッダーとその後の区切り線を非表示 */
    #report-header,
    #report-header + hr {
        display: none !important;
    }

    /* =================================== */
    /* レイアウト調整 (最重要) */
    /* =================================== */
    
    /* 1ページ目のダッシュボード部分の左右列を、印刷時は強制的に縦積み */
    #report-dashboard-content > .row > .col-md-8,
    #report-dashboard-content > .row > .col-md-4 {
        flex: 0 0 100% !important;
        max-width: 100% !important;
        padding: 0 !important;
    }
    
    /* ★★★ ここが今回の修正の核心部分です ★★★ */
    /* グラフ群をまとめる親コンテナ(id="subject-charts-row")をフレックスボックスとして定義 */
    #subject-charts-row {
        display: flex !important;
        flex-direction: row !important; /* 横並びを明示 */
        flex-wrap: wrap !important;     /* 折り返しを許可 */
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        page-break-inside: avoid !important; /* コンテナの途中で改ページされるのを防ぐ */
    }
    
    /* 親コンテナのすべての子要素（各グラフの列）の幅を25%に強制指定 */
    #subject-charts-row > * {
        flex: 0 0 25% !important;
        max-width: 25% !important;
        padding: 3px !important;
        page-break-inside: avoid !important; /* グラフの途中で改ページされるのを防ぐ */
    }

    /* =================================== */
    /* その他共通スタイル */
    /* =================================== */
    .page-break {
        page-break-after: always;
    }
    
    #report-comment-input {
        border: 1px solid #ccc !important;
        background-color: #f8f9fa !important;
        color: #000 !important;
        height: 400px;
    }

    .card, .js-plotly-plot { 
        box-shadow: none !important; 
        border: 1px solid #ddd !important; 
    }

    .row, .col, .card, h2, h4, .table { 
        page-break-inside: avoid; 
    }
    h2, h4 { 
        page-break-after: avoid; 
    }
}